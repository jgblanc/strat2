---
title: "FGrPlot"
output: html_document
date: "2025-04-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(tidyverse)
library(latex2exp)
library("gridExtra")
library(grid)
library(scales)
library(ggtext)
```


## Plot all Error 

```{r}
# Overlap data
tmp1 <- fread("../plots/overlap_stats/H_HGDP1KG.txt")
tmp2 <- fread("../plots/overlap_stats/H_InUKBB.txt")
dfAllOverlap <- rbind(tmp1, tmp2)

# Error data
tmp1 <- fread("../plots/error/error_HGDP1KG.txt")
tmp2 <- fread("../plots/error/error_InUKBB.txt")
dfError <- rbind(tmp1, tmp2)

# Combine
df <- inner_join(dfError, dfAllOverlap)

# Format Data
tmp1 <- df %>% filter(gwas %in% c("e5", "e10", "e50", "e200")) %>% separate(gwas, into = c("tmp", "gwas"), sep = "e") %>% select(-tmp)
tmp1$gwas <- factor(tmp1$gwas, levels = c( "5", "10", "50", "200")) 
tmp2 <- df %>% filter(gwas %in% c("WBS-R", "ALL-R")) %>% separate(gwas, into = c("gwas", "tmp"), sep = "-") %>% select(-tmp)
tmp3 <-  df %>% filter(gwas %in% c("WBS", "ALL"))
df <- rbind(tmp1, tmp2, tmp3)
df$gwas <- factor(df$gwas, levels = c("WBS", "5", "10", "50", "200", "ALL"))
```

```{r}
pl <- df %>% ggplot(aes(x = H, y = error, color = gwas)) + geom_point(size = 2) + scale_x_log10() + scale_y_log10() + xlab(TeX("proportion of variance in the GWAS panel explained by the target axis ($\\hat{H}$)")) + ylab(TeX("fraction of variance in direct estimator due to error ($1 - \\hat{gamma}_{f}$)")) + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), labels = c(expression("WBS"),expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), expression("ALL")))  + theme(panel.grid.minor = element_line(linetype = "dashed")) +  guides(color = guide_legend(title = "GWAS", label = scales::label_parse()))
pl
#ggsave("~/Desktop/Error.png", pl, height = 4, width = 6)
```

```{r}
table(df$error > 0.1)
```


## Common Variants 

```{r}
tmp1 <- fread("../plots/error/R2EO_HGDP1KG.txt") %>% mutate(type = "HGDP1KG")
tmp2 <- fread("../plots/error/R2EO_InUKBB.txt") %>% mutate(type = "CoB")
df <- rbind(tmp1, tmp2)

# Format Data
tmp1 <- df %>% filter(gwas %in% c("e5", "e10", "e50", "e200")) %>% separate(gwas, into = c("tmp", "gwas"), sep = "e") %>% select(-tmp) 
tmp1$gwas <- factor(tmp1$gwas, levels = c( "5", "10", "50", "200")) 
tmp2 <- df %>% filter(gwas %in% c("WBS-R", "ALL-R")) %>% separate(gwas, into = c("gwas", "tmp"), sep = "-") %>% select(-tmp)
tmp3 <-  df %>% filter(gwas %in% c("WBS", "ALL")) 
df <- rbind(tmp1, tmp2, tmp3)
df$gwas <- factor(df$gwas, levels = c("WBS", "5", "10", "50", "200", "ALL"))

# Shorten Names
rep_str = c("England" = "ENG","Wales" = "WAL", "Scotland" = "SCT","NorthernIreland" = "NI","RepublicOfIrelend" = "RoI" )
df$contrasts <- str_replace_all(df$contrasts, rep_str)

# Find significant PCs
df <- df %>% mutate(adjuB = p.adjust(pvalB)) %>% mutate(sigB = case_when(adjuB < 0.05  ~ TRUE, adjuB >= 0.05 ~ F))

# Find significant R2
df <- df %>% mutate(adjuR2 = p.adjust(pvalR2)) %>% mutate(sigR2 = case_when(adjuR2 < 0.05  ~ TRUE, adjuR2 >= 0.05 ~ F))
```

### Signal 

```{r}
pl <- df %>% ggplot(aes(x = Signal,y = Ratio, color = gwas)) + geom_point() + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), labels = c(expression("WBS"),expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), expression("ALL"))) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + geom_hline(yintercept = 0, color = "red", linetype = "dashed") + geom_vline(xintercept = 0, color = "red", linetype = "dashed") +  geom_vline(xintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 12) + theme(panel.grid.minor = element_line(linetype = "dashed")) +  guides(color = guide_legend(title = "GWAS", label = scales::label_parse())) +  xlab(TeX("Signal ($\\hat{\\gamma}_{f}$)")) + ylab(TeX("Signal captured by PCs ($V_{k}$)"))
#ggsave("~/Desktop/SignalRatio.png", pl, height = 6, width = 10)
```

### Summary Table 

Number of significant R2 
```{r}
tmp <- df %>% filter(PC == 40) %>% mutate(adjuR2 = p.adjust(pvalR2)) %>% mutate(sigR2 = case_when(adjuR2 < 0.05  ~ TRUE, adjuR2 >= 0.05 ~ F)) 
table(tmp$sigR2)
```


Table of significant PCs
```{r}
df %>%
  filter(gwas %in% c("WBS", "ALL")) %>%
  group_by(PC, gwas, type) %>%
  summarise(numSig = sum(sigB) / n(), tot = n(), .groups = "drop") %>%
  ggplot(aes(x = PC, y = numSig, color = type, group = type)) +
  geom_line() +
  geom_point()+ 
  facet_wrap(~gwas)
```
```{r}
df %>%
  filter(gwas %in% c("WBS", "ALL")) %>%
  group_by(PC, gwas, type) %>%
  summarise(numSig = sum(sigB) / n(), tot = n(), meanB = mean(abs(B)), .groups = "drop") %>%
  ggplot(aes(x = PC, y = numSig, color = type, group = type)) +
  geom_line() +
  geom_point()+ 
  facet_wrap(~gwas)
```


```{r}
# Step 1: Get order of contrasts based on H in "ALL"
ordered_contrasts <- df %>%
  filter(gwas == "ALL") %>%
  arrange(desc(H)) %>%  # or use `arrange(H)` depending on desired direction
  pull(contrasts) %>%
  unique()

# Step 2: Apply this order to the whole dataframe
df <- df %>%
  mutate(contrasts = factor(contrasts, levels = ordered_contrasts))

# Step 3: Plot
pl <- df %>%
  filter(gwas == "WBS" | gwas == "ALL") %>%
  ggplot(aes(x = PC, y = B, color = sigB)) +
  geom_point() +
  facet_grid(vars(contrasts), vars(gwas))

pl

ggsave("~/Desktop/tmp.png", pl, height = 15, width = 15)
```



### R^2 

HGDP - continental 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))  

plCont <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = R2, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Variance captured by PCs ($R^2_{k}$)"))
```

HGDP - lat/long 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur"))

plLat <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = R2, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Variance captured by PCs ($R^2_{k}$)"))
```

InUKBB 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels =c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  

plInUKBB <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = R2, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("GWAS"),  labels = c(expression("WBS"),expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), expression("ALL"))) + theme( legend.position = "bottom", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Variance captured by PCs ($R^2_{k}$)")) + ylim(0,1) +
  guides(color = guide_legend(nrow = 1))
```

Combine R2 Figures 
```{r}
# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))


# Wrap other plots with labels
row_a <- arrangeGrob(plCont, top = label_a)
row_b <- arrangeGrob(plLat, top = label_b)
row_c <- arrangeGrob(plInUKBB, top = label_c)

# Final arrangement
pl <- grid.arrange( row_a, row_b, row_c, ncol = 1, heights = c(1, 1, 1.3))
ggsave("~/Desktop/SupR2_commom.png", pl, height = 10, width = 12)
```

### Ratio

HGDP - continental 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))  

plCont <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured PCs ($V_{k}$)")) 
#+ geom_errorbar(aes(x = PC, ymin = lc, ymax = uc), width = 0.6)
```

HGDP - lat/long 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur"))

plLat <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured PCs ($V_{k}$)"))
#+ geom_errorbar(aes(x = PC, ymin = lc, ymax = uc), width = 0.6)
```


InUKBB 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels =c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  

plInUKBB <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("GWAS"), labels = c(expression("WBS"),expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), expression("ALL"))) + theme( legend.position = "bottom", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured PCs ($V_{k}$)")) +
  guides(color = guide_legend(nrow = 1)) + ylim(0,1) 
#+ geom_errorbar(aes(x = PC, ymin = lc, ymax = uc), width = 0.6)
```

Combine Ratio Figures 
```{r}
# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))


# Wrap other plots with labels
row_a <- arrangeGrob(plCont, top = label_a)
row_b <- arrangeGrob(plLat, top = label_b)
row_c <- arrangeGrob(plInUKBB, top = label_c)

# Final arrangement
pl <- grid.arrange( row_a, row_b, row_c, ncol = 1, heights = c(1, 1, 1.3))
ggsave("~/Desktop/Ratio_common.png", pl, height = 10, width = 12)
```


## Rare Variant PCA

```{r}
tmp1 <- fread("../plots/error/rare_R2EO_HGDP1KG.txt") 
tmp2 <- fread("../plots/error/rare_R2EO_InUKBB.txt")
df <- rbind(tmp1, tmp2)

# Format Data
tmp1 <- df %>% filter(gwas %in% c("e5", "e10", "e50", "e200")) %>% separate(gwas, into = c("tmp", "gwas"), sep = "e") %>% select(-tmp)
tmp1$gwas <- factor(tmp1$gwas, levels = c( "5", "10", "50", "200")) 
tmp2 <- df %>% filter(gwas %in% c("WBS-R", "ALL-R")) %>% separate(gwas, into = c("gwas", "tmp"), sep = "-") %>% select(-tmp)
tmp3 <-  df %>% filter(gwas %in% c("WBS", "ALL"))
df <- rbind(tmp1, tmp2, tmp3)
df$gwas <- factor(df$gwas, levels = c("WBS", "5", "10", "50", "200", "ALL"))

# Shorten Names
rep_str = c("England" = "ENG","Wales" = "WAL", "Scotland" = "SCT","NorthernIreland" = "NI","RepublicOfIrelend" = "RoI" )
df$contrasts <- str_replace_all(df$contrasts, rep_str)

Rare <- df
```


### Signal 

```{r}
pl <- df  %>%  ggplot(aes(x = Signal,y = Ratio, color = gwas)) + geom_point() + scale_color_manual(values = c("purple1", "darkorange", "skyblue2", "seagreen"), labels = c(expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon))) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + geom_hline(yintercept = 0, color = "red", linetype = "dashed") + geom_vline(xintercept = 0, color = "red", linetype = "dashed") +  geom_vline(xintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 12) + theme(panel.grid.minor = element_line(linetype = "dashed")) +  guides(color = guide_legend(title = "GWAS", label = scales::label_parse())) +  xlab(TeX("Signal ($\\hat{\\gamma}_{f}$)")) + ylab(TeX("Signal captured by PCs ($V_{k}$)"))
#ggsave("~/Desktop/SignalRatio_Rare.png", pl, height = 6, width = 10)
```

### Summary Plot

```{r}
df %>%
  filter(PC == 40) %>%
  ggplot(aes(x = H, y = Ratio, color = gwas)) +
  geom_point() +
  scale_x_log10(breaks = c(1e-5, 1e-4, 1e-3, 1e-2), limits = c(1e-5, 1.1e-2)) +
  ylim(0, 1) 
```

### R^2

HGDP - continental 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))  

plCont <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = R2, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1", "purple1", "darkorange", "skyblue2", "seagreen",  "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Variance captured by PCs ($R^2_{k}$)"))
```

HGDP - lat/long 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur"))

plLat <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = R2, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen",  "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Variance captured by PCs ($R^2_{k}$)"))
```

InUKBB 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels =c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  

plInUKBB <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = R2, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen",  "seagreen1"), name= TeX("GWAS"),  labels = c("WBS", expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL"))+ theme( legend.position = "bottom", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Variance captured by PCs ($R^2_{k}$)")) + ylim(0,1) +
  guides(color = guide_legend(nrow = 1))

plInUKBB
```

Combine R2 Figures 
```{r}
# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))


# Wrap other plots with labels
row_a <- arrangeGrob(plCont, top = label_a)
row_b <- arrangeGrob(plLat, top = label_b)
row_c <- arrangeGrob(plInUKBB, top = label_c)

# Final arrangement
pl <- grid.arrange( row_a, row_b, row_c, ncol = 1, heights = c(1, 1, 1.3))
ggsave("~/Desktop/SupR2_rare.png", pl, height = 10, width = 12)
```


### Ratio

HGDP - continental 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))  

plCont <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured by PCs ($V_{k}$)")) 
#+ geom_errorbar(aes(x = PC, ymin = lc, ymax = uc), width = 0.6)
```

HGDP - lat/long 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur"))

plLat <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal by captured PCs ($V_{k}$)"))
#+ geom_errorbar(aes(x = PC, ymin = lc, ymax = uc), width = 0.6)
```

InUKBB 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels =c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  

plInUKBB <- dfPlot %>% filter(PC <= 40) %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) + theme( legend.position = "bottom", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured by PCs ($V_{k}$)")) +
  guides(color = guide_legend(nrow = 1)) + ylim(0,1) 
#+ geom_errorbar(aes(x = PC, ymin = lc, ymax = uc), width = 0.6)
```

Combine Ratio Figures 
```{r}
# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))


# Wrap other plots with labels
row_a <- arrangeGrob(plCont, top = label_a)
row_b <- arrangeGrob(plLat, top = label_b)
row_c <- arrangeGrob(plInUKBB, top = label_c)

# Final arrangement
pl <- grid.arrange( row_a, row_b, row_c, ncol = 1, heights = c(1, 1, 1.3))
ggsave("~/Desktop/Ratio_rare.png", pl, height = 10, width = 12)
```

## Common + Rare

```{r}
tmp1 <- fread("../plots/error/common_rare_R2EO_HGDP1KG.txt")
tmp2 <- fread("../plots/error/common_rare_R2EO_InUKBB.txt")
df <- rbind(tmp1, tmp2)

# Format Data
tmp1 <- df %>% filter(gwas %in% c("e5", "e10", "e50", "e200")) %>% separate(gwas, into = c("tmp", "gwas"), sep = "e") %>% select(-tmp)
tmp1$gwas <- factor(tmp1$gwas, levels = c( "5", "10", "50", "200")) 
tmp2 <- df %>% filter(gwas %in% c("WBS-R", "ALL-R")) %>% separate(gwas, into = c("gwas", "tmp"), sep = "-") %>% select(-tmp)
tmp3 <-  df %>% filter(gwas %in% c("WBS", "ALL"))
df <- rbind(tmp1, tmp2, tmp3)
df$gwas <- factor(df$gwas, levels = c("WBS", "5", "10", "50", "200", "ALL"))

# Shorten Names
rep_str = c("England" = "ENG","Wales" = "WAL", "Scotland" = "SCT","NorthernIreland" = "NI","RepublicOfIrelend" = "RoI" )
df$contrasts <- str_replace_all(df$contrasts, rep_str)
```

## R^2

HGDP - continental 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))  

plCont <- ggplot(dfPlot, aes(x = PC, y = R2, color = gwas)) +
  geom_point() +
  geom_line() +
  facet_wrap(~contrasts, nrow = 1) +
  geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") +
  theme_bw(base_size = 10) +
  scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"),
                     name = TeX("Sampling distance ($\\epsilon$)")) +
  theme(
    legend.position = "none",
    strip.background = element_rect(colour = "black", fill = "white"),
    axis.text.x = element_text(size = 10, )) +
  xlab("PC") +
  ylab(TeX("Variance captured by PCs ($R^2_{k}$)")) + 
  scale_x_continuous(breaks = c(0,20,40,60,80), labels = c("0", "20", "40", "20", "40")) +
  geom_vline(xintercept = 40, color = "black", linetype = "dashed")

```

HGDP - lat/long 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur"))

plLat <- ggplot(dfPlot, aes(x = PC, y = R2, color = gwas)) +
  geom_point() +
  geom_line() +
  facet_wrap(~contrasts, nrow = 1) +
  geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") +
  theme_bw(base_size = 10) +
  scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"),
                     name = TeX("Sampling distance ($\\epsilon$)")) +
  theme(
    legend.position = "none",
    strip.background = element_rect(colour = "black", fill = "white"),
    axis.text.x = element_text(size = 10, )) +
  xlab("PC") +
  ylab(TeX("Variance captured by PCs ($R^2_{k}$)")) + 
  scale_x_continuous(breaks = c(0,20,40,60,80), labels = c("0", "20", "40", "20", "40")) +
  geom_vline(xintercept = 40, color = "black", linetype= "dashed")
```

InUKBB 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels =c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  

plInUKBB <- ggplot(dfPlot, aes(x = PC, y = R2, color = gwas)) +
  geom_point() +
  geom_line() +
  facet_wrap(~contrasts, nrow = 1) +
  geom_hline(aes(yintercept = Signal, color = gwas), linetype = "dashed") +
  theme_bw(base_size = 10) +
  scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"),
                     name = TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) +
  theme(
    legend.position = "bottom",
    strip.background = element_rect(colour = "black", fill = "white"),
    axis.text.x = element_text(size = 10 )) +
  xlab("PC") +
  ylab(TeX("Variance captured by PCs ($R^2_{k}$)")) + 
  scale_x_continuous(breaks = c(0,20,40,60,80), labels = c("0", "20", "40", "20", "40")) +
  geom_vline(xintercept = 40, color = "black", linetype = "dashed") +
  guides(color = guide_legend(nrow = 1))

plInUKBB
```

Combine R2 Figures 
```{r}
# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))


# Wrap other plots with labels
row_a <- arrangeGrob(plCont, top = label_a)
row_b <- arrangeGrob(plLat, top = label_b)
row_c <- arrangeGrob(plInUKBB, top = label_c)

# Final arrangement
pl <- grid.arrange( row_a, row_b, row_c, ncol = 1, heights = c(1, 1, 1.3))
ggsave("~/Desktop/SupR2_common_rare.png", pl, height = 10, width = 12)
```


## Ratio

HGDP - continental 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr"))  

plCont <- dfPlot %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1", "purple1", "darkorange", "skyblue2", "seagreen","seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured PCs ($V_{k}$)"))  + 
  scale_x_continuous(breaks = c(0,20,40,60,80), labels = c("0", "20", "40", "20", "40")) +
  geom_vline(xintercept = 40, color = "black", linetype = "dashed")
```

HGDP - lat/long 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels = c("eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur"))

plLat <- dfPlot %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name= TeX("Sampling distance ($\\epsilon$)")) + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured PCs ($V_{k}$)"))  + 
  scale_x_continuous(breaks = c(0,20,40,60,80), labels = c("0", "20", "40", "20", "40")) +
  geom_vline(xintercept = 40, color = "black", linetype = "dashed")
```

InUKBB 
```{r}
dfPlot <- df %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))
dfPlot$contrasts <- factor(dfPlot$contrasts, levels =c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  

plInUKBB <- dfPlot %>% ggplot(aes(x = PC, y = Ratio, color = gwas)) + geom_point() + geom_line() + facet_wrap(~contrasts, nrow = 1) + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + theme_bw(base_size = 10) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name = TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) + theme( legend.position = "bottom", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10)) + xlab("PC") + ylab(TeX("Fraction of signal captured PCs ($V_{k}$)")) +
  guides(color = guide_legend(nrow = 1)) + ylim(0,1)  + 
  scale_x_continuous(breaks = c(0,20,40,60,80), labels = c("0", "20", "40", "20", "40")) +
  geom_vline(xintercept = 40, color = "black", linetype = "dashed")
```

Combine Ratio Figures 
```{r}
# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))


# Wrap other plots with labels
row_a <- arrangeGrob(plCont, top = label_a)
row_b <- arrangeGrob(plLat, top = label_b)
row_c <- arrangeGrob(plInUKBB, top = label_c)

# Final arrangement
pl <- grid.arrange( row_a, row_b, row_c, ncol = 1, heights = c(1, 1, 1.3))
ggsave("~/Desktop/Ratio_common_rare.png", pl, height = 10, width = 12)
```


### Summary Plots 

### Bar plots

```{r}
tmp1 <- fread("../plots/error/common_rare_R2EO_HGDP1KG.txt")
tmp2 <- fread("../plots/error/common_rare_R2EO_InUKBB.txt")
df <- rbind(tmp1, tmp2)

# Format Data
tmp1 <- df %>% filter(gwas %in% c("e5", "e10", "e50", "e200")) %>% separate(gwas, into = c("tmp", "gwas"), sep = "e") %>% select(-tmp)
tmp1$gwas <- factor(tmp1$gwas, levels = c( "5", "10", "50", "200")) 
tmp2 <- df %>% filter(gwas %in% c("WBS-R", "ALL-R")) %>% separate(gwas, into = c("gwas", "tmp"), sep = "-") %>% select(-tmp)
tmp3 <-  df %>% filter(gwas %in% c("WBS", "ALL"))
df <- rbind(tmp1, tmp2, tmp3)
df$gwas <- factor(df$gwas, levels = c("WBS", "5", "10", "50", "200", "ALL"))

# Shorten Names
rep_str = c("England" = "ENG","Wales" = "WAL", "Scotland" = "SCT","NorthernIreland" = "NI","RepublicOfIrelend" = "RoI" )
df$contrasts <- str_replace_all(df$contrasts, rep_str)
```

```{r}
dfCommon <- df %>% filter(PC == 40) %>% mutate(pc_type = "common") %>% mutate(percent = Ratio)
dfBoth <- df %>% filter(PC == 80) %>% mutate(pc_type = "both") %>% mutate(percent = (Ratio - dfCommon$percent))
#dfRare <- Rare %>% filter(PC == 40) %>% mutate(pc_type = "rare")

dfAll <- rbind(dfCommon, dfBoth)
levels(dfAll$gwas) <- c("WBS" = "WBS", "5" = TeX("$5\\epsilon$"), "10" = TeX("$10\\epsilon$"), "50" = TeX("$50\\epsilon$"), "200" = TeX("$200\\epsilon$"), "ALL" = "ALL")
dfAll$contrasts <- factor(dfAll$contrasts, levels =c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr","eurasia-lat", "eurasia-long","eur-lat", "eur-long", "sdi-eur","ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL"))  
```

```{r}
pl <- dfAll%>% 
  ggplot(aes(x = contrasts, y = percent, fill = pc_type)) + 
  geom_bar(position="stack", stat="identity") + 
  facet_wrap(~gwas, ncol = 1, labeller = labeller(gwas = label_parsed)) + 
  theme_bw() +
  theme(strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10, angle = 90, hjust = 1), legend.position = "bottom") + 
  ylab(TeX("Fraction of signal captured by PCs ($V_{k}$)")) + 
  xlab("") + 
  scale_fill_manual(values = c( "#f68060", "slateblue2"), name = " ", labels = c("40 common + 40 rare", "40 common")) + 
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")

ggsave("~/Desktop/summary_barplot.png", pl, height = 7, width = 9)
```

## Dot plots 

```{r}
dfCommon <- df %>% filter(PC == 40) %>% mutate(pc_type = "common") 
dfBoth <- df %>% filter(PC == 80) %>% mutate(pc_type = "both") 
dfRare <- Rare %>% filter(PC == 40) %>% mutate(pc_type = "rare")
dfAll <- rbind(dfCommon, dfBoth, dfRare)
```


```{r}
dfAll %>% 
  filter(contrasts %in% c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr")) %>%
  ggplot(aes(x = contrasts, y = Ratio, color = gwas, shape = pc_type)) +
  geom_point()

```































## Plot R2 by Chr 

```{r}
tmp1 <- fread("../plots/error/R2Chr_HGDP1KG.txt")
tmp2 <- fread("../plots/error/R2Chr_InUKBB.txt")
df <- rbind(tmp1, tmp2)

# Format Data
tmp1 <- df %>% filter(gwas %in% c("e5", "e10", "e50", "e200")) %>% separate(gwas, into = c("tmp", "gwas"), sep = "e") %>% select(-tmp)
tmp1$gwas <- factor(tmp1$gwas, levels = c( "5", "10", "50", "200")) 
tmp2 <- df %>% filter(gwas %in% c("WBS-R", "ALL-R")) %>% separate(gwas, into = c("gwas", "tmp"), sep = "-") %>% select(-tmp)
tmp3 <-  df %>% filter(gwas %in% c("WBS", "ALL"))
df <- rbind(tmp1, tmp2, tmp3)
df$gwas <- factor(df$gwas, levels = c("WBS", "5", "10", "50", "200", "ALL"))

# Shorten Names
rep_str = c("England" = "ENG","Wales" = "WAL", "Scotland" = "SCT","NorthernIreland" = "NI","RepublicOfIrelend" = "RoI" )
df$contrasts <- str_replace_all(df$contrasts, rep_str)
```


#### Signal vs Number of Chromosomes used to calculate it 

```{r}
df %>% filter(PC == "1" ) %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr")) %>% mutate("FGr_chrs" = 22 - pca_chrs) %>% ggplot(aes(x = pca_chrs, y = Signal, color = gwas)) + geom_point() + facet_wrap(~contrasts, )  + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name = TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) + theme_bw() + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10))
```


```{r}
df %>% filter(PC == "1" ) %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur")) %>% mutate("FGr_chrs" = 22 - pca_chrs) %>% ggplot(aes(x = pca_chrs, y = Signal, color = gwas)) + geom_point() + facet_wrap(~contrasts)
```


```{r}
df %>% filter(PC == "1" ) %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL")) %>% mutate("FGr_chrs" = 22 - pca_chrs) %>% ggplot(aes(x = pca_chrs, y = Signal, color = gwas)) + geom_point() + facet_wrap(~contrasts)
```

### Ratio vs Chr split

```{r}
plCont <- df %>% filter(PC == "40") %>% filter(contrasts %in%c("eas-nfe","eas-sas","eas-afr", "eas-amr", "nfe-sas","nfe-afr", "nfe-amr","sas-afr", "sas-amr", "afr-amr")) %>% mutate("FGr_chrs" = 22 - pca_chrs) %>% ggplot(aes(x = pca_chrs, y = Ratio, color = gwas)) + geom_point() + facet_wrap(~contrasts, nrow = 1) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name = TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) + theme_bw() + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10))  + geom_hline(yintercept = 1, color = "red", linetype = "dashed") + xlab("chromosomes used in PCA") + ylab(TeX("fraction of signal captured by PCs ($V_{40}$)"))
```

```{r}
plLat <- df %>% filter(PC == "40") %>% filter(contrasts %in%c("eurasia-lat", "eurasia-long", "eur-lat", "eur-long", "sdi-eur")) %>% mutate("FGr_chrs" = 22 - pca_chrs) %>% ggplot(aes(x = pca_chrs, y = Ratio, color = gwas)) + geom_point() + facet_wrap(~contrasts, nrow = 1) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name = TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) + theme_bw() + theme( legend.position = "none", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10))  + geom_hline(yintercept = 1, color = "red", linetype = "dashed")  + xlab("chromosomes used in PCA") + ylab(TeX("fraction of signal captured by PCs ($V_{40}$)"))
```


```{r}
plInUKBB <- df %>% filter(PC == "40") %>% filter(contrasts %in%c("ENG-NI", "ENG-RoI", "ENG-SCT", "ENG-WAL", "NI-RoI", "NI-SCT", "NI-WAL", "RoI-SCT", "RoI-WAL", "SCT-WAL")) %>% mutate("FGr_chrs" = 22 - pca_chrs) %>% ggplot(aes(x = pca_chrs, y = Ratio, color = gwas)) + geom_point() + facet_wrap(~contrasts, nrow = 1) + scale_color_manual(values = c("orchid1","purple1", "darkorange", "skyblue2", "seagreen", "seagreen1"), name = TeX("GWAS"), labels = c("WBS",expression(5 * epsilon), expression(10 * epsilon),expression(50 * epsilon),expression(200 * epsilon), "ALL")) + theme_bw() + theme( legend.position = "bottom", strip.background=element_rect(colour="black",fill="white"), axis.text.x = element_text(size = 10))  + geom_hline(yintercept = 1, color = "red", linetype = "dashed")  + xlab("chromosomes used in PCA") + ylab(TeX("fraction of signal captured by PCs ($V_{40}$)")) + guides(colour = guide_legend(nrow = 1))
```


Combine Ratio Chromosome Figures 
```{r}
library(gridExtra)
library(grid)

# Define label grobs
label_a <- textGrob("a", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_b <- textGrob("b", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_c <- textGrob("c", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_d <- textGrob("d", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))
label_e <- textGrob("e", x = unit(0, "npc"), y = unit(1, "npc"),
                    just = c("left", "top"), gp = gpar(fontface = "bold", fontsize = 14))

# Wrap plots with labels
row_a <- arrangeGrob(plH, top = label_a)
row_b <- arrangeGrob(pl, top = label_b)
row_c <- arrangeGrob(plCont, top = label_c)
row_d <- arrangeGrob(plLat, top = label_d)
row_e <- arrangeGrob(plInUKBB, top = label_e)

# Combine row_a and row_b side by side
top_row <- arrangeGrob(row_a, row_b, ncol = 2)

# Final arrangement: top_row + c, d, e stacked below
final_plot <- grid.arrange(top_row, row_c, row_d, row_e,
                           ncol = 1,
                           heights = c(3, 1, 1, 1))

# Save
ggsave("~/Desktop/test.png", final_plot, height = 12, width = 12)

```

